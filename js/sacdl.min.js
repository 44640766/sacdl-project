var Utils=function(){function n(){var n={},a={name:"languages",children:[]};if(e&&e.items){var r=e.items;r.forEach(function(e,a){"undefined"==typeof n[e.language]&&(n[e.language]=a)});for(var t in n){"null"===t&&(t="others");var u={name:t,children:[]};r.forEach(function(n,e){var a={name:n.full_name,watchers_count:n.watchers_count,forks_count:n.forks_count};(n.language===t||"null"===n.language&&"others"===t)&&u.children.push(a)}),a.children.push(u)}}return a}var e,a;return{getData:function(r){e=r,a=n()},getBarData:function(){var n=a.children,e={labels:[],series:[]},r=[];return n.forEach(function(n){e.labels.push(n.name),r.push(n.children.length)}),e.series.push({label:"Projects count",values:r}),e},getStackData:function(){var n=a.children,e={name:"repos",languages:[]};return n.forEach(function(n){if("null"!==n.name){var a={language:n.name,count:n.children.length};e.languages.push(a)}}),[e]},getTreeData:function(){return a}}}();
var Searcher=function(){function t(){o.q=r.property("value")||"bitcoin";var t=[];for(var n in o)t.push(n+"="+o[n]);return s=e+"?"+t.join("&"),console.log(s),i.text("当前搜索地址: "+s),s}var e,r,n,i,s="",c=[],o={q:"bitcoin",sort:"forks",order:"desc",per_page:100};return{settings:{baseApiUrl:"https://api.github.com/search/repositories"},init:function(){r=d3.select("#search-input"),n=d3.select("#search-btn"),i=d3.select("#search-msg"),e=this.settings.baseApiUrl,n.on("click",function(){t(),c.forEach(function(t){try{t(s)}catch(e){console.log(e)}})})},addListener:function(t){c.push(t)}}}();
var Bar=function(){function t(t){for(var e=0;e<t.labels.length;e++)for(var r=0;r<t.series.length;r++)u.push(t.series[r].values[e])}function e(){u=[],a=Utils.getBarData(),i=l*a.series.length,t(a);var e=d3.scale.category20(),r=l*u.length+c*a.labels.length,g=d3.scale.linear().domain([0,d3.max(u)]).range([0,s]),h=d3.scale.linear().range([r+c,0]);n=d3.svg.axis().scale(h).tickFormat("").tickSize(0).orient("left");var f=chart.attr("width",o+s+d).attr("height",r),p=f.selectAll("g").data(u,function(t,e){return[t,e]}),x=p.enter().append("g").attr("transform",function(t,e){return"translate("+o+","+(e*l+c*(.5+Math.floor(e/a.series.length)))+")"});x.append("rect").attr("fill",function(t,r){return e(r%a.series.length)}).attr("class","bar").attr("width",g).attr("height",l-1),x.append("text").attr("x",function(t){return g(t)-3}).attr("y",l/2).attr("fill","red").attr("dy",".35em").text(function(t){return t}),x.append("text").attr("class","label").attr("x",function(t){return-10}).attr("y",i/2).attr("dy",".35em").text(function(t,e){return e%a.series.length===0?a.labels[Math.floor(e/a.series.length)]:""}),p.exit().transition().style({opacity:0}).remove(),f.append("g").attr("class","y axis").attr("transform","translate("+o+", "+-c/2+")").call(n);var b=18,v=4,y=f.selectAll(".legend").data(a.series),m=y.enter().append("g").attr("transform",function(t,e){var r=b+v,a=-c/2,n=o+s+40-b,l=e*r-a;return"translate("+n+","+l+")"});m.append("rect").attr("width",b).attr("height",b).style("fill",function(t,r){return e(r)}).style("stroke",function(t,r){return e(r)}),m.append("text").attr("class","legend").attr("x",b+v).attr("y",b-v).text(function(t){return t.label}),y.exit().remove()}var r,a,n,s=300,l=20,i=0,c=10,o=150,d=150,u=[];return{settings:{title:"barTitle",desc:"barDesc",barId:"#barId"},init:function(){r=this.settings.barId,d3.select("#barTitle").text(this.settings.title),d3.select("#barDesc").text(this.settings.desc),chart=d3.select(r).append("svg").attr("class","chart")},show:function(){e()}}}();
var Treemap=function(){function t(t){p=f=Utils.getTreeData(t);var a=i.nodes(f).filter(function(t){return!t.children}),s=c.selectAll("g").data(a,function(t){return t.watchers_count}).enter().append("g").attr("class","cell").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).on("click",function(t){return r(p==t.parent?f:t.parent)});s.append("rect").attr("width",function(t){return t.dx-1}).attr("height",function(t){return t.dy-1}).style("fill",function(t){return d(t.parent.name)}),s.append("text").attr("x",function(t){return 2*t.dx/3+20}).attr("y",function(t){return t.dy/2}).attr("dy",".35em").attr("text-anchor","middle").text(function(t){return t.name}).style("opacity",function(t){return t.w=this.getComputedTextLength(),1}),c.selectAll("g").data(a).exit().transition().style({opacity:0}).remove(),d3.select(window).on("click",function(){r(f)}),d3.select("#treemapSelect").on("change",function(){i.value("watchers"==this.value?e:n).nodes(f),r(p)})}function e(t){return t.watchers_count}function n(t){return t.forks_count}function r(t){var e=s/t.dx,n=o/t.dy;u.domain([t.x,t.x+t.dx]),l.domain([t.y,t.y+t.dy]);var r=c.selectAll("g.cell").transition().duration(d3.event.altKey?7500:750).attr("transform",function(t){return"translate("+u(t.x)+","+l(t.y)+")"});r.select("rect").attr("width",function(t){return e*t.dx-1}).attr("height",function(t){return n*t.dy-1}),r.select("text").attr("x",function(t){return 2*e*t.dx/3+20}).attr("y",function(t){return n*t.dy/2}).style("opacity",function(t){return 1}),p=t,d3.event.stopPropagation()}var a,i,c,s=970,o=500,u=d3.scale.linear().range([0,s]),l=d3.scale.linear().range([0,o]),d=d3.scale.category20c(),f=[],p=[];return{settings:{title:"treemapTitle",desc:"treemapDesc",treemapId:"#treemapId"},init:function(){var t=this.settings.treemapId;d3.select("#treemapTitle").text(this.settings.title),d3.select("#treemapDesc").text(this.settings.desc),a=d3.select(t).append("div").attr("class","chart").style("width",s+"px").style("height",o+"px"),c=a.append("svg").attr("width",s).attr("height",o).append("g").attr("transform","translate(.5,.5)"),i=d3.layout.treemap().size([s,o]).value(function(t){return t.watchers_count})},show:function(e){t(e)}}}();
!function(){function e(e){var a=setTimeout(function(){t.style.display="block"},300);e=e||"https://api.github.com/search/repositories?q=bitcoin&sort=forks&order=desc&per_page=100",d3.json(e,function(e,i){e&&(clearTimeout(a),t.style.display="none",alert("加载数据失败，请检查您的网络设置。")),Utils.getData(i),Bar.show(),Treemap.show(),clearTimeout(a),t.style.display="none"})}var t=document.getElementById("modal");Searcher.init(),Bar.settings={title:"Top100 BarChart",desc:"This is a good example.",barId:"#barId"},Bar.init(),Treemap.settings={title:"Top100 treemap",desc:"You can click the block to zoom it.",treemapId:"#sacdlTreemap"},Treemap.init(),Searcher.addListener(function(t){e(t)}),e()}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIiwic2VhcmNoZXIuanMiLCJiYXIuanMiLCJ0cmVlbWFwLmpzIiwiYXBwLmpzIl0sIm5hbWVzIjpbIlV0aWxzIiwiZGF0YVRvSnNvbiIsImxhbmd1YWdlcyIsInJlc3VsdCIsIm5hbWUiLCJjaGlsZHJlbiIsImRhdGFTZXQiLCJpdGVtcyIsImZvckVhY2giLCJpdGVtIiwiaW5kZXgiLCJsYW5ndWFnZSIsInJvb3QiLCJjaGlsZCIsImZ1bGxfbmFtZSIsIndhdGNoZXJzX2NvdW50IiwiZm9ya3NfY291bnQiLCJwdXNoIiwidHJlZURhdGEiLCJnZXREYXRhIiwiZGF0YSIsImdldEJhckRhdGEiLCJsYWJlbHMiLCJzZXJpZXMiLCJ2YWx1ZXMiLCJsZW5ndGgiLCJsYWJlbCIsImdldFN0YWNrRGF0YSIsImNvdW50IiwiZ2V0VHJlZURhdGEiLCJTZWFyY2hlciIsInBhcnNlUXVlcnkiLCJxdWVyeSIsInEiLCJpbnB1dFR4dCIsInByb3BlcnR5IiwiYXJyIiwia2V5IiwidXJsIiwiYmFzZUFwaVVybCIsImpvaW4iLCJjb25zb2xlIiwibG9nIiwic2VhcmNoTXNnIiwidGV4dCIsInNlYXJjaEJ0biIsImxpc3RlbmVycyIsInNvcnQiLCJvcmRlciIsInBlcl9wYWdlIiwic2V0dGluZ3MiLCJpbml0IiwiZDMiLCJzZWxlY3QiLCJ0aGlzIiwib24iLCJsaXN0ZW5lciIsImVycm9yIiwiYWRkTGlzdGVuZXIiLCJCYXIiLCJ6aXBwaW5nRGF0YSIsImkiLCJqIiwiemlwcGVkRGF0YSIsInNob3dCYXIiLCJncm91cEhlaWdodCIsImJhckhlaWdodCIsImNvbG9yIiwic2NhbGUiLCJjYXRlZ29yeTIwIiwiY2hhcnRIZWlnaHQiLCJnYXBCZXR3ZWVuR3JvdXBzIiwieCIsImxpbmVhciIsImRvbWFpbiIsIm1heCIsInJhbmdlIiwiY2hhcnRXaWR0aCIsInkiLCJ5QXhpcyIsInN2ZyIsImF4aXMiLCJ0aWNrRm9ybWF0IiwidGlja1NpemUiLCJvcmllbnQiLCJjaGFydCIsImF0dHIiLCJzcGFjZUZvckxhYmVscyIsInNwYWNlRm9yTGVnZW5kIiwiYmFyTm9kZXMiLCJzZWxlY3RBbGwiLCJkIiwiYmFyIiwiZW50ZXIiLCJhcHBlbmQiLCJNYXRoIiwiZmxvb3IiLCJleGl0IiwidHJhbnNpdGlvbiIsInN0eWxlIiwib3BhY2l0eSIsInJlbW92ZSIsImNhbGwiLCJsZWdlbmRSZWN0U2l6ZSIsImxlZ2VuZFNwYWNpbmciLCJsZWdlbmREYXRhIiwibGVnZW5kIiwiaGVpZ2h0Iiwib2Zmc2V0IiwiaG9yeiIsInZlcnQiLCJiYXJJZCIsInRpdGxlIiwiZGVzYyIsInNob3ciLCJUcmVlbWFwIiwic2hvd0NoYXJ0Iiwibm9kZSIsIm5vZGVzIiwidHJlZW1hcCIsImZpbHRlciIsImNlbGwiLCJ6b29tIiwicGFyZW50IiwiZHgiLCJkeSIsInciLCJnZXRDb21wdXRlZFRleHRMZW5ndGgiLCJ3aW5kb3ciLCJ2YWx1ZSIsIndhdGNoZXJzQ291bnQiLCJmb3Jrc0NvdW50Iiwia3giLCJreSIsImgiLCJ0IiwiZHVyYXRpb24iLCJldmVudCIsImFsdEtleSIsInN0b3BQcm9wYWdhdGlvbiIsImNhdGVnb3J5MjBjIiwidHJlZW1hcElkIiwibGF5b3V0Iiwic2l6ZSIsImxvYWRlciIsInNldFRpbWVvdXQiLCJsb2FkaW5nIiwiZGlzcGxheSIsImpzb24iLCJlcnIiLCJjbGVhclRpbWVvdXQiLCJhbGVydCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUlBLE9BQVMsV0E0RlQsUUFBU0MsS0FDTCxHQUFJQyxNQUVBQyxHQUNBQyxLQUFRLFlBQ1JDLFlBR0osSUFBSUMsR0FBV0EsRUFBUUMsTUFBTyxDQUMxQixHQUFJQSxHQUFRRCxFQUFRQyxLQUVwQkEsR0FBTUMsUUFBUSxTQUFTQyxFQUFNQyxHQUNlLG1CQUE3QlIsR0FBVU8sRUFBS0UsWUFDdEJULEVBQVVPLEVBQUtFLFVBQVlELElBSW5DLEtBQUssR0FBSUMsS0FBWVQsR0FBVyxDQUNYLFNBQWJT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QixXQTRCSSxRQUFTOEYsR0FBSzVFLEdBQ1YsR0FBSTBHLEdBQVNDLFdBQVcsV0FDcEJDLEVBQVEvQyxNQUFNZ0QsUUFBVSxTQUN6QixJQUVIN0csR0FBTUEsR0FBTywwRkFFYmMsR0FBR2dHLEtBQUs5RyxFQUFLLFNBQVMrRyxFQUFLakksR0FDbkJpSSxJQUNBQyxhQUFhTixHQUNiRSxFQUFRL0MsTUFBTWdELFFBQVUsT0FDeEJJLE1BQU0sc0JBR1Z2SixNQUFNbUIsUUFBUUMsR0FFZHVDLElBQUl1RCxPQUNKQyxRQUFRRCxPQUVSb0MsYUFBYU4sR0FDYkUsRUFBUS9DLE1BQU1nRCxRQUFVLFNBL0NoQyxHQUFJRCxHQUFVTSxTQUFTQyxlQUFlLFFBS3RDM0gsVUFBU3FCLE9BS1RRLElBQUlULFVBQ0E4RCxNQUFPLGtCQUNQQyxLQUFNLDBCQUNORixNQUFPLFVBRVhwRCxJQUFJUixPQUtKZ0UsUUFBUWpFLFVBQ0o4RCxNQUFPLGlCQUNQQyxLQUFNLHNDQUNONEIsVUFBVyxpQkFFZjFCLFFBQVFoRSxPQTBCUnJCLFNBQVM0QixZQUFZLFNBQVNwQixHQUMxQjRFLEVBQUs1RSxLQUdUNEUiLCJmaWxlIjoic2FjZGwubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIFV0aWxzID0gKGZ1bmN0aW9uKCkge1xuICAgIHZhciBkYXRhU2V0LCB0cmVlRGF0YTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIGdldERhdGE6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIGRhdGFTZXQgPSBkYXRhO1xuICAgICAgICAgICAgdHJlZURhdGEgPSBkYXRhVG9Kc29uKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICBEYXRhIGZvcm1hdDpcbiAgICAgICAge1xuICAgICAgICAgICAgbGFiZWxzOiBbXG4gICAgICAgICAgICAgICAgJ2MvYysrJywgJ3B5dGhvbicsICdqYXZhc2NyaXB0JyxcbiAgICAgICAgICAgICAgICAnamF2YScsICdydWJ5JywgJ2h0bWwnXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgc2VyaWVzOiBbe1xuICAgICAgICAgICAgICAgIGxhYmVsOiAnUHJvamVjdHMgY291bnQnLFxuICAgICAgICAgICAgICAgIHZhbHVlczogWzQsIDgsIDE1LCAxNiwgMjMsIDQyXSAvL2NvdW50c1xuICAgICAgICAgICAgfV1cbiAgICAgICAgfVxuICAgICAgICAqL1xuICAgICAgICBnZXRCYXJEYXRhOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBpdGVtcyA9IHRyZWVEYXRhLmNoaWxkcmVuO1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWxzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgc2VyaWVzOiBbXVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdmFsdWVzID0gW107XG5cbiAgICAgICAgICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5sYWJlbHMucHVzaChpdGVtLm5hbWUpO1xuICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKGl0ZW0uY2hpbGRyZW4ubGVuZ3RoKTtcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIHJlc3VsdC5zZXJpZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgbGFiZWw6ICdQcm9qZWN0cyBjb3VudCcsXG4gICAgICAgICAgICAgICAgdmFsdWVzOiB2YWx1ZXNcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgeyBuYW1lOiBcInJlcG9zXCIgLCBcbiAgICAgICAgICAgICAgICAgICBsYW5ndWFnZXM6IFsgIHsgbGFuZ3VhZ2U6ICdqcycsIGNvdW50OiAzMDAwIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgbGFuZ3VhZ2U6ICdydWJ5JywgY291bnQ6IDEzMDAgfV1cbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRTdGFja0RhdGE6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGl0ZW1zID0gdHJlZURhdGEuY2hpbGRyZW47XG5cbiAgICAgICAgICAgIHZhciByZXN1bHQgPSB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJyZXBvc1wiLFxuICAgICAgICAgICAgICAgIGxhbmd1YWdlczogW11cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8xLiDnoa7lrprliJ3lp4vmlbDmja5cbiAgICAgICAgICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgIGlmIChpdGVtLm5hbWUgPT09IFwibnVsbFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdmFyIGNoaWxkID0ge1xuICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogaXRlbS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBjb3VudDogaXRlbS5jaGlsZHJlbi5sZW5ndGhcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmVzdWx0Lmxhbmd1YWdlcy5wdXNoKGNoaWxkKTtcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIHJldHVybiBbcmVzdWx0XTtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqIERhdGEgZm9ybWF0OlxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJsYW5ndWFnZXNcIixcbiAgICAgICAgICAgICAgICAgICAgXCJjaGlsZHJlblwiOiBbe1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiamF2YXNjcmlwdFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjaGlsZHJlblwiOiBbe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcImltZmx5L215SURFXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ3YXRjaGVyc19jb3VudFwiOiAxMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJmb3Jrc19jb3VudFwiOiA1MFxuICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0VHJlZURhdGE6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRyZWVEYXRhO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAvL3Byb3ZpdGUgbWV0aG9kc1xuICAgIGZ1bmN0aW9uIGRhdGFUb0pzb24oKSB7XG4gICAgICAgIHZhciBsYW5ndWFnZXMgPSB7fTtcblxuICAgICAgICB2YXIgcmVzdWx0ID0ge1xuICAgICAgICAgICAgXCJuYW1lXCI6IFwibGFuZ3VhZ2VzXCIsXG4gICAgICAgICAgICBcImNoaWxkcmVuXCI6IFtdXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YVNldCAmJiBkYXRhU2V0Lml0ZW1zKSB7XG4gICAgICAgICAgICB2YXIgaXRlbXMgPSBkYXRhU2V0Lml0ZW1zO1xuXG4gICAgICAgICAgICBpdGVtcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBsYW5ndWFnZXNbaXRlbS5sYW5ndWFnZV0gPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2VzW2l0ZW0ubGFuZ3VhZ2VdID0gaW5kZXg7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIGZvciAodmFyIGxhbmd1YWdlIGluIGxhbmd1YWdlcykge1xuICAgICAgICAgICAgICAgIGlmIChsYW5ndWFnZSA9PT0gXCJudWxsXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2UgPSBcIm90aGVyc1wiO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgcm9vdCA9IHtcbiAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IGxhbmd1YWdlLFxuICAgICAgICAgICAgICAgICAgICBcImNoaWxkcmVuXCI6IFtdXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24oaXRlbSwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IGl0ZW0uZnVsbF9uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ3YXRjaGVyc19jb3VudFwiOiBpdGVtLndhdGNoZXJzX2NvdW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJmb3Jrc19jb3VudFwiOiBpdGVtLmZvcmtzX2NvdW50XG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0ubGFuZ3VhZ2UgPT09IGxhbmd1YWdlIHx8IChpdGVtLmxhbmd1YWdlID09PSBcIm51bGxcIiAmJiBsYW5ndWFnZSA9PT0gXCJvdGhlcnNcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvb3QuY2hpbGRyZW4ucHVzaChjaGlsZCk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgIHJlc3VsdC5jaGlsZHJlbi5wdXNoKHJvb3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gXG4gICAgZnVuY3Rpb24gbWVyZ2VUbyh0bywgZnJvbSkge1xuICAgICAgICBmb3IgKHZhciBrZXkgaW4gZnJvbSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB0b1trZXldID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgdG9ba2V5XSA9IGZyb21ba2V5XVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG59KCkpXG4iLCJ2YXIgU2VhcmNoZXIgPSAoZnVuY3Rpb24oKSB7XG4gICAgdmFyIHVybCA9ICcnLFxuICAgICAgICBiYXNlQXBpVXJsLFxuICAgICAgICBpbnB1dFR4dCxcbiAgICAgICAgc2VhcmNoQnRuLFxuICAgICAgICBzZWFyY2hNc2csXG4gICAgICAgIGxpc3RlbmVycyA9IFtdLFxuICAgICAgICBxdWVyeSA9IHtcbiAgICAgICAgICAgIHE6ICdiaXRjb2luJyxcbiAgICAgICAgICAgIHNvcnQ6IFwiZm9ya3NcIixcbiAgICAgICAgICAgIG9yZGVyOiBcImRlc2NcIixcbiAgICAgICAgICAgIHBlcl9wYWdlOiAxMDBcbiAgICAgICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHNldHRpbmdzOiB7XG4gICAgICAgICAgICBiYXNlQXBpVXJsOiAnaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS9zZWFyY2gvcmVwb3NpdG9yaWVzJ1xuICAgICAgICB9LFxuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaW5wdXRUeHQgPSBkMy5zZWxlY3QoJyNzZWFyY2gtaW5wdXQnKTtcbiAgICAgICAgICAgIHNlYXJjaEJ0biA9IGQzLnNlbGVjdCgnI3NlYXJjaC1idG4nKTtcbiAgICAgICAgICAgIHNlYXJjaE1zZyA9IGQzLnNlbGVjdCgnI3NlYXJjaC1tc2cnKVxuXG4gICAgICAgICAgICBiYXNlQXBpVXJsID0gdGhpcy5zZXR0aW5ncy5iYXNlQXBpVXJsO1xuXG4gICAgICAgICAgICBzZWFyY2hCdG4ub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcGFyc2VRdWVyeSgpO1xuICAgICAgICAgICAgICAgIGxpc3RlbmVycy5mb3JFYWNoKGZ1bmN0aW9uKGxpc3RlbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lcih1cmwpO1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG5cbiAgICAgICAgYWRkTGlzdGVuZXI6IGZ1bmN0aW9uKGxpc3RlbmVyKSB7XG4gICAgICAgICAgICBsaXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gcGFyc2VRdWVyeSgpIHtcbiAgICAgICAgcXVlcnkucSA9IGlucHV0VHh0LnByb3BlcnR5KCd2YWx1ZScpIHx8ICdiaXRjb2luJztcbiAgICAgICAgdmFyIGFyciA9IFtdO1xuXG4gICAgICAgIGZvciAodmFyIGtleSBpbiBxdWVyeSkge1xuICAgICAgICAgICAgYXJyLnB1c2goa2V5ICsgJz0nICsgcXVlcnlba2V5XSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdXJsID0gYmFzZUFwaVVybCArICc/JyArIGFyci5qb2luKCcmJyk7XG5cbiAgICAgICAgY29uc29sZS5sb2codXJsKTtcbiAgICAgICAgc2VhcmNoTXNnLnRleHQoJ+W9k+WJjeaQnOe0ouWcsOWdgDogJyArIHVybCk7XG4gICAgICAgIHJldHVybiB1cmw7XG4gICAgfVxufSgpKVxuIiwidmFyIEJhciA9IChmdW5jdGlvbigpIHtcbiAgICB2YXIgY2hhcnRXaWR0aCA9IDMwMCxcbiAgICAgICAgYmFySGVpZ2h0ID0gMjAsXG4gICAgICAgIGdyb3VwSGVpZ2h0ID0gMCxcbiAgICAgICAgZ2FwQmV0d2Vlbkdyb3VwcyA9IDEwLFxuICAgICAgICBzcGFjZUZvckxhYmVscyA9IDE1MCxcbiAgICAgICAgc3BhY2VGb3JMZWdlbmQgPSAxNTAsXG4gICAgICAgIGJhcklkLFxuICAgICAgICBzdmcsXG4gICAgICAgIGRhdGEsXG4gICAgICAgIHlBeGlzO1xuXG4gICAgLy8gWmlwIHRoZSBzZXJpZXMgZGF0YSB0b2dldGhlciAoZmlyc3QgdmFsdWVzLCBzZWNvbmQgdmFsdWVzLCBldGMuKVxuICAgIHZhciB6aXBwZWREYXRhID0gW107XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBzZXR0aW5nczoge1xuICAgICAgICAgICAgdGl0bGU6IFwiYmFyVGl0bGVcIixcbiAgICAgICAgICAgIGRlc2M6IFwiYmFyRGVzY1wiLFxuICAgICAgICAgICAgYmFySWQ6IFwiI2JhcklkXCJcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGJhcklkID0gdGhpcy5zZXR0aW5ncy5iYXJJZDtcblxuICAgICAgICAgICAgZDMuc2VsZWN0KFwiI2JhclRpdGxlXCIpLnRleHQodGhpcy5zZXR0aW5ncy50aXRsZSk7XG4gICAgICAgICAgICBkMy5zZWxlY3QoXCIjYmFyRGVzY1wiKS50ZXh0KHRoaXMuc2V0dGluZ3MuZGVzYyk7XG5cbiAgICAgICAgICAgIGNoYXJ0ID0gZDMuc2VsZWN0KGJhcklkKS5hcHBlbmQoXCJzdmdcIilcbiAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiY2hhcnRcIik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2hvdzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzaG93QmFyKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiB6aXBwaW5nRGF0YShkYXRhKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sYWJlbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZGF0YS5zZXJpZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICB6aXBwZWREYXRhLnB1c2goZGF0YS5zZXJpZXNbal0udmFsdWVzW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNob3dCYXIoKSB7XG4gICAgICAgIC8vQ2xlYW5cbiAgICAgICAgemlwcGVkRGF0YSA9IFtdO1xuXG4gICAgICAgIGRhdGEgPSBVdGlscy5nZXRCYXJEYXRhKCk7XG4gICAgICAgIGdyb3VwSGVpZ2h0ID0gYmFySGVpZ2h0ICogZGF0YS5zZXJpZXMubGVuZ3RoO1xuXG4gICAgICAgIHppcHBpbmdEYXRhKGRhdGEpO1xuXG4gICAgICAgIC8vIENvbG9yIHNjYWxlXG4gICAgICAgIHZhciBjb2xvciA9IGQzLnNjYWxlLmNhdGVnb3J5MjAoKTtcbiAgICAgICAgdmFyIGNoYXJ0SGVpZ2h0ID0gYmFySGVpZ2h0ICogemlwcGVkRGF0YS5sZW5ndGggKyBnYXBCZXR3ZWVuR3JvdXBzICogZGF0YS5sYWJlbHMubGVuZ3RoO1xuXG4gICAgICAgIHZhciB4ID0gZDMuc2NhbGUubGluZWFyKClcbiAgICAgICAgICAgIC5kb21haW4oWzAsIGQzLm1heCh6aXBwZWREYXRhKV0pXG4gICAgICAgICAgICAucmFuZ2UoWzAsIGNoYXJ0V2lkdGhdKTtcblxuICAgICAgICB2YXIgeSA9IGQzLnNjYWxlLmxpbmVhcigpXG4gICAgICAgICAgICAucmFuZ2UoW2NoYXJ0SGVpZ2h0ICsgZ2FwQmV0d2Vlbkdyb3VwcywgMF0pO1xuXG4gICAgICAgIHlBeGlzID0gZDMuc3ZnLmF4aXMoKVxuICAgICAgICAgICAgLnNjYWxlKHkpXG4gICAgICAgICAgICAudGlja0Zvcm1hdCgnJylcbiAgICAgICAgICAgIC50aWNrU2l6ZSgwKVxuICAgICAgICAgICAgLm9yaWVudChcImxlZnRcIik7XG5cbiAgICAgICAgdmFyIHN2ZyA9IGNoYXJ0XG4gICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIHNwYWNlRm9yTGFiZWxzICsgY2hhcnRXaWR0aCArIHNwYWNlRm9yTGVnZW5kKVxuICAgICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgY2hhcnRIZWlnaHQpO1xuXG4gICAgICAgIC8vIEdldCB0aGUgbm9kZXNcbiAgICAgICAgdmFyIGJhck5vZGVzID0gc3ZnLnNlbGVjdEFsbChcImdcIikuZGF0YSh6aXBwZWREYXRhLCBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICAgICAgcmV0dXJuIFtkLCBpXTtcbiAgICAgICAgfSlcblxuICAgICAgICAvLyBDcmVhdGUgYmFyc1xuICAgICAgICB2YXIgYmFyID0gYmFyTm9kZXNcbiAgICAgICAgICAgIC5lbnRlcigpXG4gICAgICAgICAgICAuYXBwZW5kKFwiZ1wiKVxuICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24oZCwgaSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBcInRyYW5zbGF0ZShcIiArIHNwYWNlRm9yTGFiZWxzICsgXCIsXCIgKyAoaSAqIGJhckhlaWdodCArIGdhcEJldHdlZW5Hcm91cHMgKiAoMC41ICsgTWF0aC5mbG9vcihpIC8gZGF0YS5zZXJpZXMubGVuZ3RoKSkpICsgXCIpXCI7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBDcmVhdGUgcmVjdGFuZ2xlcyBvZiB0aGUgY29ycmVjdCB3aWR0aFxuICAgICAgICBiYXIuYXBwZW5kKFwicmVjdFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJmaWxsXCIsIGZ1bmN0aW9uKGQsIGkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sb3IoaSAlIGRhdGEuc2VyaWVzLmxlbmd0aCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImJhclwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCB4KVxuICAgICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgYmFySGVpZ2h0IC0gMSk7XG5cbiAgICAgICAgLy8gQWRkIHRleHQgbGFiZWwgaW4gYmFyXG4gICAgICAgIGJhci5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgICAgICAgICAuYXR0cihcInhcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB4KGQpIC0gMztcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYXR0cihcInlcIiwgYmFySGVpZ2h0IC8gMilcbiAgICAgICAgICAgIC5hdHRyKFwiZmlsbFwiLCBcInJlZFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCBcIi4zNWVtXCIpXG4gICAgICAgICAgICAudGV4dChmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQ7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBEcmF3IGxhYmVsc1xuICAgICAgICBiYXIuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImxhYmVsXCIpXG4gICAgICAgICAgICAuYXR0cihcInhcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAtMTA7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIGdyb3VwSGVpZ2h0IC8gMilcbiAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgXCIuMzVlbVwiKVxuICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24oZCwgaSkge1xuICAgICAgICAgICAgICAgIGlmIChpICUgZGF0YS5zZXJpZXMubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YS5sYWJlbHNbTWF0aC5mbG9vcihpIC8gZGF0YS5zZXJpZXMubGVuZ3RoKV07XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJcIlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRGVsZXRlIHRoZSBleHRyYSBub2Rlc1xuICAgICAgICBiYXJOb2Rlcy5leGl0KClcbiAgICAgICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAgIC5zdHlsZSh7XG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5yZW1vdmUoKTtcblxuICAgICAgICBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInkgYXhpc1wiKVxuICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyBzcGFjZUZvckxhYmVscyArIFwiLCBcIiArIC1nYXBCZXR3ZWVuR3JvdXBzIC8gMiArIFwiKVwiKVxuICAgICAgICAgICAgLmNhbGwoeUF4aXMpO1xuXG4gICAgICAgIC8vIERyYXcgbGVnZW5kXG4gICAgICAgIHZhciBsZWdlbmRSZWN0U2l6ZSA9IDE4LFxuICAgICAgICAgICAgbGVnZW5kU3BhY2luZyA9IDQ7XG5cbiAgICAgICAgdmFyIGxlZ2VuZERhdGEgPSBzdmcuc2VsZWN0QWxsKCcubGVnZW5kJylcbiAgICAgICAgICAgIC5kYXRhKGRhdGEuc2VyaWVzKTtcblxuICAgICAgICB2YXIgbGVnZW5kID0gbGVnZW5kRGF0YVxuICAgICAgICAgICAgLmVudGVyKClcbiAgICAgICAgICAgIC5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uKGQsIGkpIHtcbiAgICAgICAgICAgICAgICB2YXIgaGVpZ2h0ID0gbGVnZW5kUmVjdFNpemUgKyBsZWdlbmRTcGFjaW5nO1xuICAgICAgICAgICAgICAgIHZhciBvZmZzZXQgPSAtZ2FwQmV0d2Vlbkdyb3VwcyAvIDI7XG4gICAgICAgICAgICAgICAgdmFyIGhvcnogPSBzcGFjZUZvckxhYmVscyArIGNoYXJ0V2lkdGggKyA0MCAtIGxlZ2VuZFJlY3RTaXplO1xuICAgICAgICAgICAgICAgIHZhciB2ZXJ0ID0gaSAqIGhlaWdodCAtIG9mZnNldDtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ3RyYW5zbGF0ZSgnICsgaG9yeiArICcsJyArIHZlcnQgKyAnKSc7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBsZWdlbmQuYXBwZW5kKCdyZWN0JylcbiAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIGxlZ2VuZFJlY3RTaXplKVxuICAgICAgICAgICAgLmF0dHIoJ2hlaWdodCcsIGxlZ2VuZFJlY3RTaXplKVxuICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgZnVuY3Rpb24oZCwgaSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb2xvcihpKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZScsIGZ1bmN0aW9uKGQsIGkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sb3IoaSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBsZWdlbmQuYXBwZW5kKCd0ZXh0JylcbiAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdsZWdlbmQnKVxuICAgICAgICAgICAgLmF0dHIoJ3gnLCBsZWdlbmRSZWN0U2l6ZSArIGxlZ2VuZFNwYWNpbmcpXG4gICAgICAgICAgICAuYXR0cigneScsIGxlZ2VuZFJlY3RTaXplIC0gbGVnZW5kU3BhY2luZylcbiAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5sYWJlbDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGxlZ2VuZERhdGEuZXhpdCgpLnJlbW92ZSgpO1xuICAgIH1cbn0oKSlcbiIsInZhciBUcmVlbWFwID0gKGZ1bmN0aW9uKCkge1xuICAgIHZhciB3ID0gOTcwLFxuICAgICAgICBoID0gNTAwLFxuICAgICAgICB4ID0gZDMuc2NhbGUubGluZWFyKCkucmFuZ2UoWzAsIHddKSxcbiAgICAgICAgeSA9IGQzLnNjYWxlLmxpbmVhcigpLnJhbmdlKFswLCBoXSksXG4gICAgICAgIGNvbG9yID0gZDMuc2NhbGUuY2F0ZWdvcnkyMGMoKSxcbiAgICAgICAgcm9vdCA9IFtdLFxuICAgICAgICBub2RlID0gW10sXG4gICAgICAgIGNoYXJ0LFxuICAgICAgICB0cmVlbWFwLFxuICAgICAgICBzdmc7XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBzZXR0aW5nczoge1xuICAgICAgICAgICAgdGl0bGU6IFwidHJlZW1hcFRpdGxlXCIsXG4gICAgICAgICAgICBkZXNjOiBcInRyZWVtYXBEZXNjXCIsXG4gICAgICAgICAgICB0cmVlbWFwSWQ6IFwiI3RyZWVtYXBJZFwiXG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdHJlZW1hcElkID0gdGhpcy5zZXR0aW5ncy50cmVlbWFwSWQ7XG5cbiAgICAgICAgICAgIGQzLnNlbGVjdChcIiN0cmVlbWFwVGl0bGVcIikudGV4dCh0aGlzLnNldHRpbmdzLnRpdGxlKTtcbiAgICAgICAgICAgIGQzLnNlbGVjdChcIiN0cmVlbWFwRGVzY1wiKS50ZXh0KHRoaXMuc2V0dGluZ3MuZGVzYyk7XG5cbiAgICAgICAgICAgIGNoYXJ0ID0gZDMuc2VsZWN0KHRyZWVtYXBJZCkuYXBwZW5kKFwiZGl2XCIpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImNoYXJ0XCIpXG4gICAgICAgICAgICAgICAgLnN0eWxlKFwid2lkdGhcIiwgdyArIFwicHhcIilcbiAgICAgICAgICAgICAgICAuc3R5bGUoXCJoZWlnaHRcIiwgaCArIFwicHhcIilcblxuICAgICAgICAgICAgc3ZnID0gY2hhcnRcbiAgICAgICAgICAgICAgICAuYXBwZW5kKFwic3ZnXCIpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCB3KVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGgpXG4gICAgICAgICAgICAgICAgLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSguNSwuNSlcIik7XG5cbiAgICAgICAgICAgIHRyZWVtYXAgPSBkMy5sYXlvdXQudHJlZW1hcCgpXG4gICAgICAgICAgICAgICAgLy8gLnJvdW5kKGZhbHNlKVxuICAgICAgICAgICAgICAgIC5zaXplKFt3LCBoXSlcbiAgICAgICAgICAgICAgICAvLyAuc3RpY2t5KGZhbHNlKVxuICAgICAgICAgICAgICAgIC52YWx1ZShmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkLndhdGNoZXJzX2NvdW50O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIHNob3dDaGFydChkYXRhKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNob3dDaGFydChkYXRhKSB7XG4gICAgICAgIG5vZGUgPSByb290ID0gVXRpbHMuZ2V0VHJlZURhdGEoZGF0YSk7XG5cbiAgICAgICAgdmFyIG5vZGVzID0gdHJlZW1hcC5ub2Rlcyhyb290KVxuICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICFkLmNoaWxkcmVuO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGNlbGwgPSBzdmcuc2VsZWN0QWxsKFwiZ1wiKVxuICAgICAgICAgICAgLmRhdGEobm9kZXMsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC53YXRjaGVyc19jb3VudDtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZW50ZXIoKVxuICAgICAgICAgICAgLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJjZWxsXCIpXG4gICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwidHJhbnNsYXRlKFwiICsgZC54ICsgXCIsXCIgKyBkLnkgKyBcIilcIjtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAub24oXCJjbGlja1wiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHpvb20obm9kZSA9PSBkLnBhcmVudCA/IHJvb3QgOiBkLnBhcmVudCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBjZWxsLmFwcGVuZChcInJlY3RcIilcbiAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLmR4IC0gMTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQuZHkgLSAxO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb2xvcihkLnBhcmVudC5uYW1lKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGNlbGwuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMiAqIGQuZHggLyAzICsgMjA7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5keSAvIDI7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCBcIi4zNWVtXCIpXG4gICAgICAgICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgICAgICAgICAudGV4dChmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQubmFtZTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICBkLncgPSB0aGlzLmdldENvbXB1dGVkVGV4dExlbmd0aCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgICAgIC8vIHJldHVybiBkLmR4ID4gZC53ID8gMSA6IDA7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBzdmcuc2VsZWN0QWxsKFwiZ1wiKVxuICAgICAgICAgICAgLmRhdGEobm9kZXMpXG4gICAgICAgICAgICAuZXhpdCgpXG4gICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAuc3R5bGUoe1xuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDBcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAucmVtb3ZlKCk7XG5cbiAgICAgICAgZDMuc2VsZWN0KHdpbmRvdykub24oXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHpvb20ocm9vdCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGQzLnNlbGVjdChcIiN0cmVlbWFwU2VsZWN0XCIpLm9uKFwiY2hhbmdlXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdHJlZW1hcC52YWx1ZSh0aGlzLnZhbHVlID09IFwid2F0Y2hlcnNcIiA/IHdhdGNoZXJzQ291bnQgOiBmb3Jrc0NvdW50KS5ub2Rlcyhyb290KTtcbiAgICAgICAgICAgIHpvb20obm9kZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHdhdGNoZXJzQ291bnQoZCkge1xuICAgICAgICByZXR1cm4gZC53YXRjaGVyc19jb3VudDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBmb3Jrc0NvdW50KGQpIHtcbiAgICAgICAgcmV0dXJuIGQuZm9ya3NfY291bnQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gem9vbShkKSB7XG4gICAgICAgIHZhciBreCA9IHcgLyBkLmR4LFxuICAgICAgICAgICAga3kgPSBoIC8gZC5keTtcbiAgICAgICAgeC5kb21haW4oW2QueCwgZC54ICsgZC5keF0pO1xuICAgICAgICB5LmRvbWFpbihbZC55LCBkLnkgKyBkLmR5XSk7XG5cbiAgICAgICAgdmFyIHQgPSBzdmcuc2VsZWN0QWxsKFwiZy5jZWxsXCIpLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgLmR1cmF0aW9uKGQzLmV2ZW50LmFsdEtleSA/IDc1MDAgOiA3NTApXG4gICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwidHJhbnNsYXRlKFwiICsgeChkLngpICsgXCIsXCIgKyB5KGQueSkgKyBcIilcIjtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHQuc2VsZWN0KFwicmVjdFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGt4ICogZC5keCAtIDE7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBreSAqIGQuZHkgLSAxO1xuICAgICAgICAgICAgfSlcblxuICAgICAgICB0LnNlbGVjdChcInRleHRcIilcbiAgICAgICAgICAgIC5hdHRyKFwieFwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDIgKiBreCAqIGQuZHggLyAzICsgMjA7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ga3kgKiBkLmR5IC8gMjtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICAvLyByZXR1cm4ga3ggKiBkLmR4ID4gZC53ID8gMSA6IDA7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBub2RlID0gZDtcbiAgICAgICAgZDMuZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfVxuXG59KCkpXG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGxvYWRpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1vZGFsXCIpO1xuXG4gICAgLyoqXG4gICAgICogU2VhcmNoXG4gICAgICovXG4gICAgU2VhcmNoZXIuaW5pdCgpO1xuXG4gICAgLyoqXG4gICAgICogc3RhcnQgQmFyQ2hhcnRcbiAgICAgKi9cbiAgICBCYXIuc2V0dGluZ3MgPSB7XG4gICAgICAgIHRpdGxlOiBcIlRvcDEwMCBCYXJDaGFydFwiLFxuICAgICAgICBkZXNjOiBcIlRoaXMgaXMgYSBnb29kIGV4YW1wbGUuXCIsXG4gICAgICAgIGJhcklkOiBcIiNiYXJJZFwiXG4gICAgfVxuICAgIEJhci5pbml0KCk7XG5cbiAgICAvKipcbiAgICAgKiBzdGFydCB0cmVlbWFwXG4gICAgICovXG4gICAgVHJlZW1hcC5zZXR0aW5ncyA9IHtcbiAgICAgICAgdGl0bGU6IFwiVG9wMTAwIHRyZWVtYXBcIixcbiAgICAgICAgZGVzYzogXCJZb3UgY2FuIGNsaWNrIHRoZSBibG9jayB0byB6b29tIGl0LlwiLFxuICAgICAgICB0cmVlbWFwSWQ6IFwiI3NhY2RsVHJlZW1hcFwiXG4gICAgfVxuICAgIFRyZWVtYXAuaW5pdCgpO1xuXG4gICAgZnVuY3Rpb24gc2hvdyh1cmwpIHtcbiAgICAgICAgdmFyIGxvYWRlciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBsb2FkaW5nLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICAgIH0sIDMwMCk7XG5cbiAgICAgICAgdXJsID0gdXJsIHx8ICdodHRwczovL2FwaS5naXRodWIuY29tL3NlYXJjaC9yZXBvc2l0b3JpZXM/cT1iaXRjb2luJnNvcnQ9Zm9ya3Mmb3JkZXI9ZGVzYyZwZXJfcGFnZT0xMDAnO1xuXG4gICAgICAgIGQzLmpzb24odXJsLCBmdW5jdGlvbihlcnIsIGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQobG9hZGVyKTtcbiAgICAgICAgICAgICAgICBsb2FkaW5nLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICBhbGVydChcIuWKoOi9veaVsOaNruWksei0pe+8jOivt+ajgOafpeaCqOeahOe9kee7nOiuvue9ruOAglwiKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgVXRpbHMuZ2V0RGF0YShkYXRhKTtcblxuICAgICAgICAgICAgQmFyLnNob3coKTtcbiAgICAgICAgICAgIFRyZWVtYXAuc2hvdygpO1xuXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobG9hZGVyKTtcbiAgICAgICAgICAgIGxvYWRpbmcuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBTZWFyY2hlci5hZGRMaXN0ZW5lcihmdW5jdGlvbih1cmwpIHtcbiAgICAgICAgc2hvdyh1cmwpO1xuICAgIH0pXG5cbiAgICBzaG93KCk7XG59KSgpXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
